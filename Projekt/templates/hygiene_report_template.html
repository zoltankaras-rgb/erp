<!doctype html>
<html lang="sk">
<head>
  <meta charset="utf-8">
  <title>{{ title }}</title>
  <style>
    body{ font:14px system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; margin:20px; color:#111;}
    h1,h2{ margin:0 0 6px; }
    .muted{ color:#6b7280; }
    table{ width:100%; border-collapse:collapse; }
    th, td{ border:1px solid #e5e7eb; padding:8px; text-align:left; vertical-align:top; }
    th{ background:#fff5f5; }
    .num{ text-align:right; }
    .small{ font-size:12px; color:#444; }
    .header{ display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:10px;}
    .filters{ margin-bottom:10px; }
    .nowrap{ white-space:nowrap;}
  </style>
</head>
<body>
  <div class="header">
    <div>
      <h1>Hygienický záznam</h1>
      <div class="muted small">{{ title }}</div>
      <div class="small">Obdobie: {{ period_str }}</div>
    </div>
    {% if filters and (filters.task or filters.agent_id) %}
    <div class="filters small">
      <div><strong>Filter úloha:</strong> {{ filters.task or '—' }}</div>
      <div><strong>Filter prípravok (ID):</strong> {{ filters.agent_id or '—' }}</div>
    </div>
    {% endif %}
  </div>

  <table>
    <thead>
      <tr>
        <th>Úloha</th>
        <th>Miesto</th>
        <th class="nowrap">Začiatok</th>
        <th class="nowrap">Koniec pôsobenia</th>
        <th class="nowrap">Koniec oplachu</th>
        <th class="nowrap">Ukončené</th>
        <th>Pracovník</th>
        <th>Prípravok</th>
        <th>Koncentrácia</th>
        <th>Čas pôsobenia</th>
        <th>Poznámka</th>
        <th>Kontroloval</th>
        <th class="nowrap">Kontrolované</th>
      </tr>
    </thead>
    <tbody>
      {% for r in records %}
      <tr>
        <td>{{ r.task_name or '' }}</td>
        <td>{{ r.location or '' }}</td>
        <td class="nowrap">{{ r.start_time and r.start_time.strftime('%H:%M') or '' }}</td>
        <td class="nowrap">{{ r.exposure_end and r.exposure_end.strftime('%H:%M') or '' }}</td>
        <td class="nowrap">{{ r.rinse_end and r.rinse_end.strftime('%H:%M') or '' }}</td>
        <td class="nowrap">{{ r.end_time and r.end_time.strftime('%H:%M') or '' }}</td>
        <td>{{ r.performed_by or '' }}</td>
        <td>{{ r.agent_name or '' }}</td>
        <td>{{ r.concentration or '' }}</td>
        <td>{{ r.exposure_time or '' }}</td>
        <td>{{ r.notes or '' }}</td>
        <td>{{ r.checked_by_fullname or '' }}</td>
        <td class="nowrap">{{ r.checked_at and r.checked_at.strftime('%d.%m.%Y %H:%M') or '' }}</td>
      </tr>
      {% endfor %}
      {% if not records %}
      <tr><td colspan="13" class="small">Žiadne záznamy.</td></tr>
      {% endif %}
    </tbody>
  </table>
</body>
</html>
